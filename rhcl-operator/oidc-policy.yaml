# OIDCPolicy must be in the same namespace as the target HTTPRoute (Kuadrant constraint).
apiVersion: extensions.kuadrant.io/v1alpha1
kind: OIDCPolicy
metadata:
  name: neuralbank-oidc
  namespace: neuralbank-stack
  annotations:
    argocd.argoproj.io/sync-wave: "5"
spec:
  provider:
    issuerURL: "https://rhbk.apps.cluster-wjvhz.dynamic.redhatworkshops.io/realms/neuralbank"
    clientID: neuralbank-frontend
    clientSecret: "FYtNXAyn6eRmWxHIig7oLhK3zxQ1nLaF"
    
    authorizationEndpoint: "https://rhbk.apps.cluster-wjvhz.dynamic.redhatworkshops.io/realms/neuralbank/protocol/openid-connect/auth"
    tokenEndpoint: "https://rhbk.apps.cluster-wjvhz.dynamic.redhatworkshops.io/realms/neuralbank/protocol/openid-connect/token"
    redirectURI: "https://neuralbank.apps.cluster-wjvhz.dynamic.redhatworkshops.io/auth/callback"
   
  targetRef:
    group: gateway.networking.k8s.io
    kind: HTTPRoute
    name: neuralbank-api-route

  auth:
    tokenSource:
      authorizationHeader:
        name: Authorization
        prefix: Bearer
      cookie:
        name: jwt