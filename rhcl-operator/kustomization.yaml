apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  #- keycloak-authpolicy.yaml
  #- neuralbank-oidc-callback.yaml
  - rolebinding.yaml
  - oidc-policy.yaml
  # Kuadrant CR is deployed to istio-system via rhcl-operator/kuadrant-system app (kuadrant-istio)
  - neuralbank-route.yaml
  - ratelimit-policy-customers.yaml
  - litemaas-gateway-route.yaml
  - litemaas-gateway-rbac.yaml

namespace: neuralbank-stack

patches:
  # LiteMaaS Gateway in istio-system; HTTPRoute in litemaas
  - target:
      kind: Gateway
      name: litemaas-gateway
    patch: |-
      - op: replace
        path: /metadata/namespace
        value: istio-system
  - target:
      kind: HTTPRoute
      name: litemaas-route
    patch: |-
      - op: replace
        path: /metadata/namespace
        value: litemaas
  # RBAC: Gateway Role+RoleBinding -> istio-system; HTTPRoute Role+RoleBinding -> litemaas
  - target:
      kind: Role
      name: litemaas-gitops-gateway-role
    patch: |-
      - op: replace
        path: /metadata/namespace
        value: istio-system
  - target:
      kind: RoleBinding
      name: litemaas-gitops-gateway-rolebinding
    patch: |-
      - op: replace
        path: /metadata/namespace
        value: istio-system
  - target:
      kind: Role
      name: litemaas-gitops-httproute-role
    patch: |-
      - op: replace
        path: /metadata/namespace
        value: litemaas
  - target:
      kind: RoleBinding
      name: litemaas-gitops-httproute-rolebinding
    patch: |-
      - op: replace
        path: /metadata/namespace
        value: litemaas
