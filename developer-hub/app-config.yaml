kind: ConfigMap
apiVersion: v1
metadata:
  name: app-config-rhdh
  labels:
    rhdh.redhat.com/ext-config-sync: 'true'
  annotations:
    rhdh.redhat.com/backstage-name: developer-hub
data:
  app-config-rhdh.yaml: |
    app:
      title: AI Dev Developer Hub
      baseUrl: "${RHDH_BASE_URL}"
    integrations:
      github:
        - host: github.com
          token: ${GITHUB_INTEGRATION}
      gitlab:
        - host: gitlab.com
          # Token is required to avoid rate limits when using multiple providers
          # Set GITLAB_INTEGRATION secret with your GitLab personal access token
          token: ${GITLAB_INTEGRATION}
    auth:
      environment: production
      session:
        secret: "${BACKEND_SECRET}"
      providers:
        oidc:
          production:
            metadataUrl: "${KEYCLOAK_METADATA_URL}"
            clientId: "${KEYCLOAK_CLIENT_ID}"
            clientSecret: "${KEYCLOAK_CLIENT_SECRET}"
            callbackUrl: "${RHDH_CALLBACK_URL}"
            prompt: auto
            signIn:
              resolvers:
                - resolver: preferredUsernameMatchingUserEntityName
    backend:
      auth:
        externalAccess:
          - type: static
            options:
              token: ${BACKEND_SECRET}
              subject: admin-curl-access
        keys:
          - secret: "${BACKEND_SECRET}"
      baseUrl: "${RHDH_BASE_URL}"
      cors:
        origin: "${RHDH_BASE_URL}"
      csp:
        upgrade-insecure-requests: false
        img-src:
          - "'self'"
          - "data:"
          - https://img.freepik.com
          - https://cdn.dribbble.com     
    signInPage: oidc
    catalog:
      providers:
        keycloakOrg:
          default:
            baseUrl: "${KEYCLOAK_BASE_URL}"
            loginRealm: "${KEYCLOAK_REALM}"
            realm: "${KEYCLOAK_REALM}"
            clientId: "${KEYCLOAK_CLIENT_ID}"
            clientSecret: "${KEYCLOAK_CLIENT_SECRET}"
            schedule:
              frequency: { minutes: 30 }
              timeout: { minutes: 5 }
              initialDelay: { seconds: 15 }
            signIn:
              resolvers:
                - resolver: emailMatchingUserEntityProfileEmail
        gitlab:
          connectivity-link-developer-hub:
            host: gitlab.com
            project: maximilianoPizarro/connectivity-link
            branch: main
            catalogPath: /developer-hub/catalog-info.yaml
            # Token inherited from integrations.gitlab, but can be overridden here if needed
            # token: ${GITLAB_INTEGRATION}
            schedule:
              frequency: { minutes: 30 }
              timeout: { minutes: 5 }
              initialDelay: { seconds: 15 }
          connectivity-link-neuralbank-stack:
            host: gitlab.com
            project: maximilianoPizarro/connectivity-link
            branch: main
            catalogPath: /neuralbank-stack/catalog-info.yaml
            schedule:
              frequency: { minutes: 30 }
              timeout: { minutes: 5 }
              initialDelay: { seconds: 20 }
          connectivity-link-rhbk:
            host: gitlab.com
            project: maximilianoPizarro/connectivity-link
            branch: main
            catalogPath: /rhbk/catalog-info.yaml
            schedule:
              frequency: { minutes: 30 }
              timeout: { minutes: 5 }
              initialDelay: { seconds: 25 }
          connectivity-link-rhcl-operator:
            host: gitlab.com
            project: maximilianoPizarro/connectivity-link
            branch: main
            catalogPath: /rhcl-operator/catalog-info.yaml
            schedule:
              frequency: { minutes: 30 }
              timeout: { minutes: 5 }
              initialDelay: { seconds: 30 }
          connectivity-link-servicemeshoperator3:
            host: gitlab.com
            project: maximilianoPizarro/connectivity-link
            branch: main
            catalogPath: /servicemeshoperator3/catalog-info.yaml
            schedule:
              frequency: { minutes: 30 }
              timeout: { minutes: 5 }
              initialDelay: { seconds: 35 }
          connectivity-link-devspaces:
            host: gitlab.com
            project: maximilianoPizarro/connectivity-link
            branch: main
            catalogPath: /devspaces/catalog-info.yaml
            schedule:
              frequency: { minutes: 30 }
              timeout: { minutes: 5 }
              initialDelay: { seconds: 40 }
          connectivity-link-operators:
            host: gitlab.com
            project: maximilianoPizarro/connectivity-link
            branch: main
            catalogPath: /operators/catalog-info.yaml
            schedule:
              frequency: { minutes: 30 }
              timeout: { minutes: 5 }
              initialDelay: { seconds: 45 }
          connectivity-link-workshop-pipelines:
            host: gitlab.com
            project: maximilianoPizarro/connectivity-link
            branch: main
            catalogPath: /workshop-pipelines/catalog-info.yaml
            schedule:
              frequency: { minutes: 30 }
              timeout: { minutes: 5 }
              initialDelay: { seconds: 50 }
          connectivity-link-openshift-gitops:
            host: gitlab.com
            project: maximilianoPizarro/connectivity-link
            branch: main
            catalogPath: /openshift-gitops/catalog-info.yaml
            schedule:
              frequency: { minutes: 30 }
              timeout: { minutes: 5 }
              initialDelay: { seconds: 55 }
          connectivity-link-namespaces:
            host: gitlab.com
            project: maximilianoPizarro/connectivity-link
            branch: main
            catalogPath: /namespaces/catalog-info.yaml
            schedule:
              frequency: { minutes: 30 }
              timeout: { minutes: 5 }
              initialDelay: { seconds: 60 }
      rules:
          - allow: [Component, Group, User, Resource, Location, Template, API]
    lightspeed:
      servers:
        #- id: ollama
        #  url: "http://librechat-ollama.librechat.svc.cluster.local:11434/v1" # Change this to your Ollama URL if it's different
        #  token: "EMPTY"      
        - id: "${LLM_SERVER_ID}"
          url: "${LLM_SERVER_URL}"
          token: "${LLM_SERVER_TOKEN}"
    permission:
      enabled: true
      rbac:
        policies-csv-file: ./rbac-policy.csv
        policyFileReload: true
        admin:
          users:
            - name: user:default/maximilianopizarro

